import pandas as pd
from Base_ETL import BaseETL

class Comorbidity04_01(BaseETL):

    def run(self):
        
        df = pd.DataFrame()
        
        o_ID= [253810826586047789404348481030431684593,
                326501866878917757463362632667757640831,
                195617666485813725358482260857079686908,
                241137843121121607227270571213144000976,
                135733139930627531408575655058451497541,
                100040675,
                100466742,
                100630825,
                100639996,
                100640244,
                100180460,
                100037103,
                39223844103658028756311173892873307077,
                100630829,
                238316215575254327635887060328395450701,
                65769570171931060500423073681760298705,
                293288833286061635822620617264171001152,
                237770400860410505800339922895135370203,
                290173280241027269095597105998870835312,
                12527873910025870672839018987391439524,
                178707979096742703194092948750484965505,
                321863770572292777838330419617301267724,
                60121829342341058681210176812627642089,
                340110578935145209954045265076180048478,
                307426081687664317357050549069515309475,
                315598259950293319427911196216863365325,
                197786034364340427631812194543912158452,
                139977138924930500625056759491656511539,
                100030026,
                100544787,
                272171178010863619410698173002635054471,
                333369765259669268705988538663573869107,
                100013676,
                100432723,
                100739419,
                100494455,
                100517764
        ]
        
        for x in o_ID:
            
            f = open("Comorbidity_Test/Comorbidity_04_01(HTN).txt", 'rt', encoding = 'UTF8')
            
            sql= ''
            
            while True:
                
                line = f.readline()
                
                if not line: 
                    break
                
                a = str(line)
                
                sql  = sql + a
                
            sql = sql.format(x)
            
            f.close()
            
            data = self.df_from_sql(db_name = "gc_raw_test", sql = sql)
            
            df = pd.concat([df, data], axis = 0, sort = False) 
            
        df = df.sort_values(['ID', 'HTN_Date'])
        
        df = df.reset_index(drop = True)
        #df.to_excel('C:/Users/Hyunjeong Ki/Gastric_Cancer_xlsx/Comorbidity_HTN_1.xlsx')
        
        self.insert(df, db_name = "comorbidity_protocol", tb_name = "comorbidity_04_01") #tb_name = "tb_tmp_comorbidity_04_00"


if __name__ == "__main__":
    obj = Comorbidity04_01()
    obj.run()